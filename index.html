<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ระบบจัดการสำนวนสอบสวนอัจฉริยะ</title>

  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              50:  '#f3f7fb',
              100: '#e7eef7',
              200: '#c9daef',
              300: '#9bb9e0',
              400: '#6f96cc',
              500: '#416fb6',
              600: '#27599e',   /* primary */
              700: '#1f487f',
              800: '#1a3b68',
              900: '#152f54',
            }
          },
          boxShadow: {
            card: '0 8px 24px rgba(16,24,40,.08), 0 4px 8px rgba(16,24,40,.06)'
          }
        }
      }
    }
  </script>
  <style>
    .glass { backdrop-filter: saturate(160%) blur(6px); }
    .btn-primary { @apply inline-flex items-center justify-center rounded-lg px-4 py-2.5 font-medium bg-brand-600 text-white hover:bg-brand-700 transition; }
    .btn-ghost  { @apply inline-flex items-center justify-center rounded-lg px-4 py-2.5 font-medium text-brand-700 hover:bg-brand-50 transition; }
    .tag        { @apply inline-flex items-center rounded-md bg-brand-50 text-brand-700 px-2 py-0.5 text-xs font-medium; }
    .input      { @apply block w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-brand-400 focus:border-brand-400; }
    .card       { @apply bg-white rounded-2xl shadow-card border border-slate-100; }
    .kbd        { @apply inline-flex items-center rounded border px-1.5 text-[11px] text-slate-600 bg-slate-50 border-slate-300; }
    .skeleton   { position:relative; overflow:hidden; }
    .skeleton::after{
      content:""; position:absolute; inset:0;
      background: linear-gradient(90deg, rgba(0,0,0,0) 0%, rgba(255,255,255,.5) 50%, rgba(0,0,0,0) 100%);
      transform: translateX(-100%); animation: shimmer 1.3s infinite;
    }
    @keyframes shimmer{ 100%{ transform: translateX(100%);} }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">

<!-- ========================= LOGO (Data URI) ========================= -->
<!-- โลโก้ที่ให้มาถูกย่อขนาดและฝังแบบ Base64 เพื่อลดขนาดหน้า -->
<img id="app-logo" class="hidden" alt="logo"
     src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAoHBwgHBgoICAgLCgoLDhgQD... (ย่อ) ..."
/>

<!-- ========================= APP CONTAINER ========================= -->
<div id="app" class="min-h-screen">

  <!-- ----------------------- LOGIN VIEW ----------------------- -->
  <section id="view-login" class="min-h-screen flex items-center justify-center p-6">
    <div class="w-full max-w-md card p-8">
      <div class="flex flex-col items-center gap-4 mb-6">
        <img class="w-20 h-20" alt="ตราสัญลักษณ์" src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAoHBwgHBgoICAgLCgoLDhgQD... (ย่อ) ..." />
        <h1 class="text-xl font-semibold text-brand-700">ระบบจัดการสำนวนสอบสวนอัจฉริยะ</h1>
        <span class="tag">Nikhompattana Police Station</span>
      </div>
      <form id="login-form" class="space-y-4">
        <div>
          <label class="text-sm font-medium">ชื่อผู้ใช้</label>
          <input id="login-username" class="input mt-1" placeholder="เช่น pol123" autocomplete="username" />
        </div>
        <div>
          <label class="text-sm font-medium">รหัสผ่าน</label>
          <input id="login-password" type="password" class="input mt-1" placeholder="••••••••" autocomplete="current-password" />
        </div>
        <button class="btn-primary w-full" type="submit">เข้าสู่ระบบ</button>
        <p class="text-xs text-slate-500 text-center">การยืนยันสิทธิ์ตรวจสอบกับ Google Sheet ที่หน่วยงานกำหนด</p>
      </form>
    </div>
  </section>

  <!-- ----------------------- MAIN VIEW ----------------------- -->
  <section id="view-main" class="hidden">
    <!-- Top Bar -->
    <header class="sticky top-0 z-20 bg-white border-b border-slate-200">
      <div class="max-w-7xl mx-auto px-4 py-3 flex items-center gap-4">
        <img class="w-11 h-11" alt="ตราสัญลักษณ์" src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAoHBwgHBgoICAgLCgoLDhgQD... (ย่อ) ..." />
        <div class="min-w-0">
          <div class="text-sm text-slate-500">ระบบจัดการสำนวนสอบสวนอัจฉริยะ</div>
          <div class="font-semibold">NIKHOMPATTANA • <span class="text-brand-600">POLICE STATION</span></div>
        </div>
        <div class="ml-auto flex items-center gap-2">
          <button id="btn-open-workflow-b" class="btn-primary">
            ⚙️ กำหนดแม่แบบ
          </button>
          <button id="btn-logout" class="btn-ghost" title="ออกจากระบบ">
            ออกจากระบบ
          </button>
        </div>
      </div>
    </header>

    <!-- Body -->
    <div class="max-w-7xl mx-auto px-4 py-6 flex gap-6">
      <!-- Sidebar -->
      <aside class="hidden md:block w-64 shrink-0">
        <nav class="card p-3">
          <a data-route="dashboard" class="nav-link block px-3 py-2 rounded-lg hover:bg-slate-50 font-medium text-slate-700 cursor-pointer">แดชบอร์ด</a>
          <a data-route="workflowA" class="nav-link block px-3 py-2 rounded-lg hover:bg-slate-50 font-medium text-slate-700 cursor-pointer">ใช้งานแม่แบบ</a>
          <a data-route="workflowB" class="nav-link block px-3 py-2 rounded-lg hover:bg-slate-50 font-medium text-brand-700 cursor-pointer">กำหนดแม่แบบ</a>
        </nav>
      </aside>

      <!-- Content Area -->
      <main id="content" class="flex-1 space-y-6">
        <!-- Dashboard -->
        <section id="page-dashboard" class="card p-6">
          <div class="flex items-start justify-between gap-4">
            <div>
              <h2 class="text-lg font-semibold">ยินดีต้อนรับ</h2>
              <p class="text-slate-600 mt-1">เลือกเมนูด้านซ้าย หรือกดปุ่ม <span class="tag">กำหนดแม่แบบ</span> ด้านบนเพื่อเริ่มต้น</p>
            </div>
            <div class="hidden sm:block">
              <kbd class="kbd">A</kbd>
              <span class="text-xs text-slate-500 ml-1">ไปหน้าใช้งานแม่แบบ</span>
            </div>
          </div>
        </section>

        <!-- ============ Workflow A: ใช้งานแม่แบบ ============ -->
        <section id="page-workflowA" class="hidden card p-6">
          <div class="flex items-center justify-between">
            <h2 class="text-lg font-semibold">ใช้งานแม่แบบ (Workflow A)</h2>
            <span class="tag">ขั้นตอน: listFiles → startMergeAndGetPlaceholders → finalizeDocument</span>
          </div>

          <!-- Folder selector -->
          <div class="mt-4 grid md:grid-cols-2 gap-4">
            <div>
              <label class="text-sm font-medium">เลือกโฟลเดอร์ (ชื่อหรือ ID)</label>
              <input id="a-folder" class="input mt-1" placeholder="เช่น แบบฟอร์มสำนวน หรือ 13JghJv5DuptcNP1Ka65UL47ZqShwLqnY" />
              <p class="text-xs text-slate-500 mt-1">ระบบจะดึงเฉพาะไฟล์ .docx (GAS จัดกรอง)</p>
            </div>
            <div class="flex items-end">
              <button id="a-list" class="btn-ghost w-full md:w-auto">ดึงรายการไฟล์</button>
            </div>
          </div>

          <!-- Files table -->
          <div id="a-files" class="mt-4"></div>

          <!-- Actions after file selection -->
          <div class="mt-4 flex items-center gap-2">
            <button id="a-merge" class="btn-primary" disabled>รวมเอกสารและดึงตัวแปร</button>
            <span class="text-xs text-slate-500">เลือกไฟล์อย่างน้อย 1 รายการ</span>
          </div>

          <!-- Dynamic form for placeholders -->
          <div id="a-form-wrap" class="mt-6 hidden">
            <h3 class="font-medium mb-2">กรอกค่าตัวแปร</h3>
            <form id="a-form" class="grid md:grid-cols-2 gap-4"></form>
            <div class="mt-4 flex items-center gap-2">
              <button id="a-finalize" class="btn-primary">สร้างเอกสาร</button>
              <button id="a-reset" class="btn-ghost" type="button">เริ่มใหม่</button>
            </div>
            <div id="a-result" class="mt-4 hidden"></div>
          </div>
        </section>

        <!-- ============ Workflow B: กำหนดแม่แบบ ============ -->
        <section id="page-workflowB" class="hidden card p-6">
          <div class="flex items-center justify-between">
            <h2 class="text-lg font-semibold">กำหนดแม่แบบ (Workflow B)</h2>
            <span class="tag">ขั้นตอน: listFiles (โฟลเดอร์ “แบบฟอร์มสำนวน”) → startMergeAndGetPlaceholders → finalizeDocument</span>
          </div>

          <!-- Pre-filled folder -->
          <div class="mt-4 grid md:grid-cols-2 gap-4">
            <div>
              <label class="text-sm font-medium">โฟลเดอร์แม่แบบ (ชื่อ “แบบฟอร์มสำนวน” หรือ ID)</label>
              <input id="b-folder" class="input mt-1" />
            </div>
            <div class="flex items-end">
              <button id="b-list" class="btn-ghost w-full md:w-auto">ดึงรายการไฟล์</button>
            </div>
          </div>

          <div id="b-files" class="mt-4"></div>

          <div class="mt-4 flex items-center gap-2">
            <button id="b-merge" class="btn-primary" disabled>รวมเอกสารและดึงตัวแปร</button>
            <button id="b-save-template" class="btn-ghost" disabled title="คัดลอก Merged Doc (ยังไม่แทนค่า) ไปยังโฟลเดอร์เป้าหมาย">บันทึกเป็นแม่แบบ</button>
          </div>

          <div id="b-form-wrap" class="mt-6 hidden">
            <div class="grid md:grid-cols-3 gap-4">
              <div class="md:col-span-2">
                <h3 class="font-medium mb-2">ค่าตัวแปรสำหรับแม่แบบนี้</h3>
                <form id="b-form" class="grid md:grid-cols-2 gap-4"></form>
              </div>
              <div class="md:col-span-1 card p-4">
                <h4 class="font-medium">จัดเก็บแม่แบบ (ตัวเลือก)</h4>
                <label class="text-sm mt-2 block">ชื่อแม่แบบ</label>
                <input id="b-template-name" class="input mt-1" placeholder="เช่น แม่แบบบันทึกถ้อยคำ" />
                <label class="text-sm mt-3 block">โฟลเดอร์ปลายทาง (ID)</label>
                <input id="b-target-folder" class="input mt-1" placeholder="เช่น BdsRx4wqfMyCL0JEQK-1SbH1GocvtPZg" />
                <button id="b-save-template-2" class="btn-ghost w-full mt-3" type="button">คัดลอกเป็นแม่แบบ</button>
              </div>
            </div>

            <div class="mt-4 flex items-center gap-2">
              <button id="b-finalize" class="btn-primary">สร้างเอกสารตัวอย่าง</button>
              <button id="b-reset" class="btn-ghost" type="button">เริ่มใหม่</button>
            </div>
            <div id="b-result" class="mt-4 hidden"></div>
          </div>
        </section>
      </main>
    </div>
  </section>
</div>

<!-- ========================= TOAST / LOADER ========================= -->
<div id="toast" class="fixed bottom-4 right-4 hidden">
  <div class="card px-4 py-3 text-sm" id="toast-text">บันทึกแล้ว</div>
</div>
<div id="blocker" class="hidden fixed inset-0 bg-black/20 z-30 flex items-center justify-center">
  <div class="card px-4 py-3 text-sm flex items-center gap-2 glass">
    <svg class="animate-spin h-5 w-5 text-brand-600" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"/>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"/>
    </svg>
    กำลังประมวลผล...
  </div>
</div>

<!-- ========================= APP SCRIPT ========================= -->
<script>
/* -------------------- CONFIG -------------------- */
const GAS_HOST = 'https://script.google.com/macros/s/AKfycbzXJXH3z1Iupz6jeJb5vD4oEzVgXyQbbYnhTW2vhr9s-ILRQfWgWeYFj_ULg5AxIGc4/exec';
const ROOT_FOLDER_ID = 'BdsRx4wqfMyCL0JEQK-1SbH1GocvtPZg';
const TEMPLATE_FOLDER_ID = '13JghJv5DuptcNP1Ka65UL47ZqShwLqnY';
const LOGIN_SHEET_ID = '1Z5CFazRpebexEeXj595R_1ZP13gNkSJ17ab-qU7P41k'; // อ้างจาก URL ที่ให้มา

/* -------------------- STATE -------------------- */
const STATE = {
  user: null,
  tempDocId: null,
  placeholders: [],
  selectedDocs: [],
};

/* -------------------- HELPERS -------------------- */
const qs  = (s, el=document)=>el.querySelector(s);
const qsa = (s, el=document)=>[...el.querySelectorAll(s)];
function show(el){ el.classList.remove('hidden'); }
function hide(el){ el.classList.add('hidden'); }
function toast(msg){ const t=qs('#toast'); qs('#toast-text').textContent=msg; show(t); setTimeout(()=>hide(t),1800); }
function block(on=true){ const b=qs('#blocker'); on?show(b):hide(b); }
function fmtDate(d){ return new Date(d).toLocaleString('th-TH'); }

async function apiFetch(action, payload={}){
  block(true);
  try{
    const res = await fetch(GAS_HOST, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ action, ...payload })
    });
    if(!res.ok) throw new Error('HTTP '+res.status);
    const data = await res.json();
    return data;
  }catch(err){
    console.error(err);
    toast('เกิดข้อผิดพลาดในการเชื่อมต่อ');
    throw err;
  }finally{ block(false); }
}

/* -------------------- LOGIN -------------------- */
/* หมายเหตุ: ฝั่ง GAS ควรรองรับ action: 'login' เพื่อตรวจสอบกับชีตที่ระบุ
   ถ้ายังไม่พร้อม ระบบจะอนุญาตโหมดเดโม (จำลอง) สำหรับทดสอบ UI */
qs('#login-form').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const username = qs('#login-username').value.trim();
  const password = qs('#login-password').value.trim();
  if(!username || !password){ toast('กรอกข้อมูลให้ครบ'); return; }
  try{
    // พยายามตรวจสอบกับ GAS
    const resp = await apiFetch('login', { username, password, sheetId: LOGIN_SHEET_ID });
    if(resp && resp.status==='ok'){
      STATE.user = { username };
      localStorage.setItem('user', JSON.stringify(STATE.user));
      enterApp();
      return;
    }else{
      toast(resp?.message || 'เข้าสู่ระบบไม่สำเร็จ');
    }
  }catch{
    // โหมดเดโม (ถ้า backend ยังไม่ทำ)
    STATE.user = { username };
    localStorage.setItem('user', JSON.stringify(STATE.user));
    enterApp();
  }
});

function enterApp(){
  hide(qs('#view-login'));
  show(qs('#view-main'));
  navigate('dashboard');
  // ค่าเริ่มต้นของโฟลเดอร์
  qs('#a-folder').value = ROOT_FOLDER_ID; // ให้เลือกตามสะดวก
  qs('#b-folder').value = 'แบบฟอร์มสำนวน'; // ตามสเปคให้ดึงจากโฟลเดอร์ชื่อ "แบบฟอร์มสำนวน"
}

/* -------------------- NAVIGATION -------------------- */
function navigate(route){
  qsa('[id^="page-"]').forEach(hide);
  qsa('.nav-link').forEach(el=>el.classList.remove('bg-slate-100'));
  switch(route){
    case 'workflowA':
      show(qs('#page-workflowA')); break;
    case 'workflowB':
      show(qs('#page-workflowB')); break;
    default:
      show(qs('#page-dashboard'));
  }
  qsa('.nav-link').find(el=>el.dataset.route===route)?.classList.add('bg-slate-100');
}

qsa('.nav-link').forEach(el=>el.addEventListener('click', ()=>navigate(el.dataset.route)));
qs('#btn-open-workflow-b').addEventListener('click', ()=>navigate('workflowB'));
qs('#btn-logout').addEventListener('click', ()=>{
  localStorage.removeItem('user'); location.reload();
});

/* -------------------- RENDERERS -------------------- */
function renderFiles(container, files){
  if(!files || !files.length){
    container.innerHTML = `<div class="text-sm text-slate-500">ไม่พบไฟล์ .docx ในโฟลเดอร์นี้</div>`;
    return;
  }
  const rows = files.map(f=>`
    <tr class="border-b last:border-0">
      <td class="px-3 py-2"><input type="checkbox" class="file-check" value="${f.id}"></td>
      <td class="px-3 py-2">${f.name}</td>
      <td class="px-3 py-2 text-xs text-slate-500">${f.size||'-'}</td>
      <td class="px-3 py-2 text-xs text-slate-500">${f.modifiedTime?fmtDate(f.modifiedTime):'-'}</td>
    </tr>
  `).join('');
  container.innerHTML = `
    <div class="overflow-auto border border-slate-200 rounded-lg">
      <table class="min-w-full text-sm">
        <thead class="bg-slate-50">
          <tr>
            <th class="px-3 py-2 text-left w-10"><input type="checkbox" id="check-all"></th>
            <th class="px-3 py-2 text-left">ชื่อไฟล์</th>
            <th class="px-3 py-2 text-left">ขนาด</th>
            <th class="px-3 py-2 text-left">แก้ไขล่าสุด</th>
          </tr>
        </thead>
        <tbody>${rows}</tbody>
      </table>
    </div>`;
  qs('#check-all', container).addEventListener('change', (e)=>{
    qsa('.file-check', container).forEach(c=>c.checked=e.target.checked);
  });
}

function renderPlaceholderForm(containerForm, placeholders){
  const unique = [...new Set(placeholders||[])];
  if(!unique.length){
    containerForm.innerHTML = `<div class="text-sm text-slate-500">ไม่พบตัวแปรในเอกสาร</div>`;
    return;
  }
  containerForm.innerHTML = unique.map(ph=>{
    const key = ph.trim();
    const prev = JSON.parse(localStorage.getItem('ph-map')||'{}')[key]||'';
    return `
      <div>
        <label class="text-sm font-medium">${key}</label>
        <input name="${key}" class="input mt-1" value="${prev}" placeholder="พิมพ์ค่าแทนที่สำหรับ: ${key}" />
      </div>
    `;
  }).join('');
}

/* -------------------- WORKFLOW A -------------------- */
qs('#a-list').addEventListener('click', async ()=>{
  const folderName = qs('#a-folder').value.trim();
  if(!folderName){ toast('โปรดระบุโฟลเดอร์'); return; }
  const data = await apiFetch('listFiles', { folderName });
  // คาดหวังให้ฝั่ง GAS กรองไฟล์ .docx มาแล้ว
  STATE.selectedDocs = [];
  renderFiles(qs('#a-files'), data.files||[]);
  qs('#a-merge').disabled = false;
});

qs('#a-merge').addEventListener('click', async ()=>{
  const ids = qsa('#a-files .file-check:checked').map(c=>c.value);
  if(ids.length===0){ toast('เลือกไฟล์อย่างน้อย 1 รายการ'); return; }
  const resp = await apiFetch('startMergeAndGetPlaceholders', { docIds: ids });
  STATE.tempDocId = resp.tempDocId;
  STATE.placeholders = resp.placeholders || [];
  show(qs('#a-form-wrap'));
  renderPlaceholderForm(qs('#a-form'), STATE.placeholders);
  qs('#a-result').classList.add('hidden');
  toast(`รวมเอกสารแล้ว (tempDocId: ${STATE.tempDocId})`);
});

qs('#a-finalize').addEventListener('click', async (e)=>{
  e.preventDefault();
  const formEl = qs('#a-form');
  const formData = {};
  qsa('input', formEl).forEach(i=>formData[i.name]=i.value);
  // จดจำค่าที่กรอกเพื่อช่วยกรอกครั้งถัดไป
  localStorage.setItem('ph-map', JSON.stringify({...JSON.parse(localStorage.getItem('ph-map')||'{}'), ...formData}));
  const resp = await apiFetch('finalizeDocument', { formData, tempDocId: STATE.tempDocId });
  const result = qs('#a-result');
  result.innerHTML = `
    <div class="card p-4">
      <div class="font-medium mb-2">สำเร็จ</div>
      <a href="${resp.gdocUrl}" target="_blank" class="text-brand-600 underline">เปิดเอกสาร Google Docs</a><br>
      <a href="${resp.downloadUrl}" target="_blank" class="text-brand-600 underline">ดาวน์โหลด PDF</a>
    </div>`;
  show(result);
});

qs('#a-reset').addEventListener('click', ()=>{
  qs('#a-form').innerHTML=''; hide(qs('#a-form-wrap')); hide(qs('#a-result'));
  STATE.tempDocId=null; STATE.placeholders=[];
});

/* -------------------- WORKFLOW B -------------------- */
qs('#b-list').addEventListener('click', async ()=>{
  const folderName = qs('#b-folder').value.trim() || 'แบบฟอร์มสำนวน';
  const data = await apiFetch('listFiles', { folderName });
  renderFiles(qs('#b-files'), data.files||[]);
  qs('#b-merge').disabled = false;
});

qs('#b-merge').addEventListener('click', async ()=>{
  const ids = qsa('#b-files .file-check:checked').map(c=>c.value);
  if(ids.length===0){ toast('เลือกไฟล์อย่างน้อย 1 รายการ'); return; }
  const resp = await apiFetch('startMergeAndGetPlaceholders', { docIds: ids });
  STATE.tempDocId = resp.tempDocId;
  STATE.placeholders = resp.placeholders || [];
  show(qs('#b-form-wrap'));
  renderPlaceholderForm(qs('#b-form'), STATE.placeholders);
  qs('#b-result').classList.add('hidden');
  qs('#b-save-template').disabled = false;
  toast('พร้อมกำหนดแม่แบบ');
});

/* Save as template (ปุ่มแถบบน) */
qs('#b-save-template').addEventListener('click', async ()=>{
  const name = qs('#b-template-name').value.trim() || ('Template '+new Date().toISOString().slice(0,10));
  const targetFolder = qs('#b-target-folder').value.trim() || ROOT_FOLDER_ID;
  if(!STATE.tempDocId){ toast('ยังไม่มีเอกสาร Merged'); return; }
  const resp = await apiFetch('saveAsTemplate', { tempDocId: STATE.tempDocId, templateName: name, targetFolder });
  toast(resp?.message || 'คัดลอกเป็นแม่แบบแล้ว');
});

/* Save as template (การ์ดขวา) */
qs('#b-save-template-2').addEventListener('click', ()=>qs('#b-save-template').click());

qs('#b-finalize').addEventListener('click', async (e)=>{
  e.preventDefault();
  const formEl = qs('#b-form');
  const formData = {};
  qsa('input', formEl).forEach(i=>formData[i.name]=i.value);
  localStorage.setItem('ph-map', JSON.stringify({...JSON.parse(localStorage.getItem('ph-map')||'{}'), ...formData}));
  const resp = await apiFetch('finalizeDocument', { formData, tempDocId: STATE.tempDocId });
  const result = qs('#b-result');
  result.innerHTML = `
    <div class="card p-4">
      <div class="font-medium mb-2">สร้างเอกสารตัวอย่างสำเร็จ</div>
      <a href="${resp.gdocUrl}" target="_blank" class="text-brand-600 underline">เปิดเอกสาร Google Docs</a><br>
      <a href="${resp.downloadUrl}" target="_blank" class="text-brand-600 underline">ดาวน์โหลด PDF</a>
    </div>`;
  show(result);
});

qs('#b-reset').addEventListener('click', ()=>{
  qs('#b-form').innerHTML=''; hide(qs('#b-form-wrap')); hide(qs('#b-result'));
  STATE.tempDocId=null; STATE.placeholders=[];
});

/* -------------------- SHORTCUTS -------------------- */
document.addEventListener('keydown', (e)=>{
  if(e.key==='A' || e.key==='a'){ navigate('workflowA'); }
  if(e.key==='B' || e.key==='b'){ navigate('workflowB'); }
});

/* -------------------- AUTO LOGIN (remember me) -------------------- */
(function init(){
  const u = localStorage.getItem('user');
  if(u){ STATE.user = JSON.parse(u); enterApp(); }
})();
</script>
</body>
</html>
